
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>AI à¸¥à¹ˆà¸²à¸¡à¸£à¹‰à¸²à¸™à¸§à¸±à¸ªà¸”à¸¸ V7.0 (Gemini 2.0 Flash)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Kanit', sans-serif; background: #f1f5f9; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; position: fixed; width: 100%; }
        .header { background: linear-gradient(135deg, #f97316, #ea580c); color: white; padding: calc(16px + env(safe-area-inset-top)) 16px 16px 16px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; background: #f8fafc; }
        .bubble { max-width: 80%; padding: 12px 16px; border-radius: 20px; margin-bottom: 12px; word-wrap: break-word; }
        .user-bubble { margin-left: auto; background: linear-gradient(135deg, #f97316, #ea580c); color: white; border-bottom-right-radius: 4px; }
        .ai-bubble { background: white; color: #1e293b; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-bottom-left-radius: 4px; }
        .footer { background: white; padding: 16px; padding-bottom: calc(16px + env(safe-area-inset-bottom)); border-top: 1px solid #e2e8f0; }
        .main-btn { width: 100%; background: linear-gradient(135deg, #f97316, #ea580c); color: white; border: none; padding: 20px; border-radius: 16px; font-size: 20px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px; }
        .lang-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .lang-btn { padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; background: #f8fafc; cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 11px; }
        .lang-btn.primary { background: #1e293b; color: white; }
        #status-ui { display: none; text-align: center; padding: 20px; background: #fff1f2; border-radius: 16px; border: 2px solid #f43f5e; margin-bottom: 12px; }
        .listening-dot { width: 12px; height: 12px; background: #f43f5e; border-radius: 50%; display: inline-block; animation: pulse 1s infinite; margin-right: 8px; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ—ï¸ AI à¸¥à¹ˆà¸²à¸¡à¸£à¹‰à¸²à¸™à¸§à¸±à¸ªà¸”à¸¸ V7.0</h1>
        <div style="display:flex; gap:10px;">
            <button onclick="clearChat()" style="background:none; border:none; color:white; font-size:1.2rem;"><i class="fas fa-trash"></i></button>
            <button onclick="openSettings()" style="background:none; border:none; color:white; font-size:1.2rem;"><i class="fas fa-cog"></i></button>
        </div>
    </div>

    <div class="chat-area" id="chat-area"></div>

    <div class="footer">
        <div id="status-ui">
            <span class="listening-dot"></span>
            <span id="status-text" style="color:#e11d48; font-weight:600;">à¸à¸³à¸¥à¸±à¸‡à¸Ÿà¸±à¸‡...</span>
        </div>
        <div id="ui-buttons">
            <button class="main-btn" onclick="startInterpreter('th-TH','à¹„à¸—à¸¢')">
                <i class="fas fa-microphone"></i> <span>à¸‰à¸±à¸™à¸à¸¹à¸” (à¹„à¸—à¸¢)</span>
            </button>
            <div class="lang-grid">
                <button class="lang-btn primary" onclick="startInterpreter('en-US','English')">ğŸ‡ºğŸ‡¸<br>ENG</button>
                <button class="lang-btn" onclick="startInterpreter('my-MM','à¸à¸¡à¹ˆà¸²')">ğŸ‡²ğŸ‡²<br>à¸à¸¡à¹ˆà¸²</button>
                <button class="lang-btn" onclick="startInterpreter('lo-LA','à¸¥à¸²à¸§')">ğŸ‡±ğŸ‡¦<br>à¸¥à¸²à¸§</button>
                <button class="lang-btn" onclick="startInterpreter('km-KH','à¹€à¸‚à¸¡à¸£')">ğŸ‡°ğŸ‡­<br>à¹€à¸‚à¸¡à¸£</button>
                <button class="lang-btn" onclick="startInterpreter('zh-CN','à¸ˆà¸µà¸™')">ğŸ‡¨ğŸ‡³<br>à¸ˆà¸µà¸™</button>
                <button class="lang-btn" onclick="startInterpreter('ja-JP','à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™')">ğŸ‡¯ğŸ‡µ<br>à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™</button>
                <button class="lang-btn" onclick="startInterpreter('ko-KR','à¹€à¸à¸²à¸«à¸¥à¸µ')">ğŸ‡°ğŸ‡·<br>à¹€à¸à¸²à¸«à¸¥à¸µ</button>
                <button class="lang-btn" onclick="startInterpreter('de-DE','à¹€à¸¢à¸­à¸£à¸¡à¸±à¸™')">ğŸ‡©ğŸ‡ª<br>à¹€à¸¢à¸­à¸£à¸¡à¸±à¸™</button>
            </div>
        </div>
    </div>

    <div id="modal-settings" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
        <div style="background:white; padding:24px; border-radius:20px; width:90%; max-width:400px;">
            <h3>ğŸ”‘ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² API Key</h3>
            <input type="password" id="api-input" placeholder="à¸§à¸²à¸‡ API Key à¸—à¸µà¹ˆà¸™à¸µà¹ˆ" style="width:100%; padding:12px; margin:15px 0; border:1px solid #ccc; border-radius:8px;">
            <button onclick="saveKey()" style="width:100%; padding:12px; background:#f97316; color:white; border:none; border-radius:8px;">à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¹ƒà¸«à¸¡à¹ˆ</button>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('gemini_key') || '';
        let targetLang = 'en-US';
        let recognition = null;
        let isBusy = false;
        let silenceTimer = null;

        function openSettings() { document.getElementById('modal-settings').style.display = 'flex'; }
        function saveKey() { const val = document.getElementById('api-input').value.trim(); if(val) { localStorage.setItem('gemini_key', val); location.reload(); } }
        function clearChat() { if(confirm('à¸¥à¹‰à¸²à¸‡à¹à¸Šà¸—?')) document.getElementById('chat-area').innerHTML = ''; }

        async function translateAPI(text, fromCode) {
            if (!API_KEY) return "âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² API Key";
            const map = {'en-US':'English','my-MM':'Burmese','lo-LA':'Lao','km-KH':'Khmer','zh-CN':'Chinese','ja-JP':'Japanese','ko-KR':'Korean','de-DE':'German'};
            const toLang = fromCode === 'th-TH' ? (map[targetLang] || 'English') : 'Thai';
            
            try {
                // à¸­à¸±à¸›à¹€à¸”à¸•à¹€à¸›à¹‡à¸™ Gemini 2.0 Flash (Experimental)
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: `You are an interpreter in a construction material store. Translate the following to ${toLang} naturally: "${text}"` }]
                        }]
                    })
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text.trim();
            } catch (e) {
                console.error(e);
                return `âš ï¸ API Error: ${e.message}`;
            }
        }

        function speak(text, code) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = code;
            u.rate = 1.0; 
            u.onend = () => { isBusy = false; };
            window.speechSynthesis.speak(u);
        }

        function startInterpreter(code, name) {
            if (isBusy) return;
            if (!API_KEY) return openSettings();
            const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SR) return alert("à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸š");

            recognition = new SR();
            recognition.lang = code;
            recognition.interimResults = true;
            recognition.continuous = true;

            if (code !== 'th-TH') targetLang = code;
            let finalResult = '';
            document.getElementById('ui-buttons').style.display = 'none';
            document.getElementById('status-ui').style.display = 'block';

            recognition.onresult = (e) => {
                clearTimeout(silenceTimer); 
                let interim = '';
                for (let i = e.resultIndex; i < e.results.length; ++i) {
                    if (e.results[i].isFinal) finalResult += e.results[i][0].transcript;
                    else interim = e.results[i][0].transcript;
                }
                silenceTimer = setTimeout(() => {
                    if (finalResult || interim) {
                        finalResult = finalResult || interim;
                        recognition.stop();
                    }
                }, 2200);
            };

            recognition.onend = async () => {
                document.getElementById('ui-buttons').style.display = 'block';
                document.getElementById('status-ui').style.display = 'none';
                if (finalResult && !isBusy) {
                    isBusy = true;
                    addMsg(finalResult, 'user', name);
                    const translated = await translateAPI(finalResult, code);
                    addMsg(translated, 'ai', code === 'th-TH' ? name : 'à¹„à¸—à¸¢');
                    speak(translated, code === 'th-TH' ? targetLang : 'th-TH');
                } else { isBusy = false; }
            };
            recognition.start();
        }

        function addMsg(text, type, label) {
            const area = document.getElementById('chat-area');
            const div = document.createElement('div');
            div.className = `bubble ${type}-bubble`;
            div.innerHTML = `<small style="display:block; font-size:10px; opacity:0.7;">${label}</small>${text}`;
            area.appendChild(div);
            area.scrollTop = area.scrollHeight;
        }
        if(!API_KEY) openSettings();
    </script>
</body>
</html>
